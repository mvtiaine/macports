PortSystem          1.0

name                audacious-uade
version             0.14.0
license             GPL-2+
categories          audio
homepage            https://github.com/mvtiaine/audacious-uade
description         UADE plugin for Audacious and DeaDBeeF

master_sites        https://github.com/mvtiaine/audacious-uade/releases/download/${version}/
distname            audacious-uade-${version}
use_bzip2           yes
checksums           rmd160  76d43a1c73210486d55d1c8b5bb9304674fd37ee \
                    sha256  22f141117b7c101770b2a8bfc8b55e9b77c815c454931bb2ba4114ac167e4063 \
                    size    9415474

depends_build       port:pkgconfig \
                    port:gmake

build.cmd   ${prefix}/bin/gmake

compiler.cxx_standard   2017

configure.args-append \
                    --with-static-stdlibs=no \
                    --enable-plugin-audacious=no \
                    --enable-plugin-deadbeef=no

universal_variant   no

default_variants    +openmpt +libxmp +audacious

variant openmpt description {Build with libopenmpt support} {
    depends_lib-append      port:libopenmpt
}

variant libxmp description {Build with libxmp support} {
    depends_lib-append      port:libxmp
}

variant audacious description {Build Audacious plugin} {
    depends_lib-append      port:audacious-core
    configure.args-delete   --enable-plugin-audacious=no
    configure.args-append   --enable-plugin-audacious=yes
}

variant deadbeef description {Build DeaDBeeF plugin} {
    depends_lib-append      port:DeaDBeeF
    configure.cppflags-append   -isystem/Applications/MacPorts/DeaDBeeF.app/Contents/Headers
    configure.args-delete       --enable-plugin-deadbeef=no
    configure.args-append \
                       --enable-plugin-deadbeef=yes \
                       --with-deadbeef-plugindir=/Applications/MacPorts/DeaDBeeF.app/Contents/PlugIns
}

if {[variant_isset openmpt] && [variant_isset libxmp]} {
    configure.args-append   --enable-players=all
}

if {![variant_isset audacious] && ![variant_isset deadbeef]} {
    ui_error "audacious or deadbeef variant must be enabled"
    error "audacious or deadbeef variant must be enabled"
}

test.run        yes
test.target     check
